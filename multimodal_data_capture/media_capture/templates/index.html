<!DOCTYPE html>
<html>
<head>
    <title>Capture Image and Record Audio</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
     <h1>Capture Image and Record Audio</h1>
    <form method="POST">
        {% csrf_token %}
        <button type="submit" name="capture">Capture Image</button>
    </form>

    <h2>Audio Recording</h2>
    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>

    {% if img_paths %}
    <h2>Captured Images:</h2>
    {% for img_path in img_paths %}
    <div>
        <img src="{{ img_path }}" alt="Captured Image" style="max-width: 300px; height: auto;">
        <br>
        <a href="{{ img_path }}" download>Download Image</a>
    </div>
    {% endfor %}
    {% endif %}
    
    {% if audio_paths %}
    <h2>Recorded Audio:</h2>
    {% for audio_path in audio_paths %}
    <div>
        <audio controls>
            <source src="{{ audio_path }}" type="audio/wav">
            Your browser does not support the audio element.
        </audio>
        <br>
        <a href="{{ audio_path }}" download>Download Audio</a>
    </div>
    {% endfor %}
    {% endif %}
    
    <script>
        $(document).ready(function() {
            $('#startRecording').click(function() {
                $.post('', {
                    'action': 'start_recording',
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                }, function(data) {
                    alert(data.status);
                    $('#startRecording').prop('disabled', true);
                    $('#stopRecording').prop('disabled', false);
                });
            });

            $('#stopRecording').click(function() {
                $.post('', {
                    'action': 'stop_recording',
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                }, function(data) {
                    alert(data.status);
                    $('#startRecording').prop('disabled', false);
                    $('#stopRecording').prop('disabled', true);
                    location.reload(); // Reload the page to show the new audio file
                });
            });
        });
    </script>
</body>
</html>
